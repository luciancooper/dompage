/* dompage v0.3
 * Copyright (c) 2017 Lucian Cooper
 */
!function(){var e=function(){function e(e){for(;e.parentElement&&"BODY"!==e.parentElement.tagName;){if(e.parentElement.id)return e.parentElement;e=e.parentElement}return null}function t(t,n){let l=e(t);for(;null!=l;){if(n.includes(l.id))return l.id;l=e(l)}}return function(e){let n=e.getAttribute("page-tabbed"),l=document.getElementById(n);if(!l)return void console.warn(`Could not set up tabs: element with id '${n}' does not exist in document`);let i={},o=Array.prototype.map.call(l.querySelectorAll("a[href^='#']"),e=>{let t=e.hash.slice(1),n=document.getElementById(t);if(null!==n)return n.classList.add("tab"),i[t]=e,t;e.classList.add("disabled")}).filter(e=>void 0!==e),a=document.forms.pagecontrol.appendChild(document.createElement("input"));var d;if(a.type="hidden",a.name="active_tab",window.location.hash){let e=window.location.hash.slice(1);e:if(o.includes(e))a.value=e;else{let n=document.getElementById(e);if(!n)break e;let l=t(n,o);if(!l)break e;a.value=l,d=n}}if(!a.value){if(!o.length)return;a.value=o[0]}document.getElementById(a.value).classList.toggle("active",!0),i[a.value].classList.add("selected"),d&&d.scrollIntoView(),window.addEventListener("hashchange",function(e){if(!window.location.hash)return;let n,l,d=window.location.hash.slice(1);if(o.includes(d))n=d;else{if(!(l=document.getElementById(d)))return;if(!(n=t(l,o)))return}a.value!==n&&(document.getElementById(a.value).classList.toggle("active",!1),document.getElementById(n).classList.toggle("active",!0),i[a.value].classList.toggle("selected",!1),i[a.value=n].classList.add("selected"),l&&l.scrollIntoView())})}}();var t,n=function(){var e={left:function(e){let t=document.getElementById(e.target.value),n=e.target.checked;Array.prototype.forEach.call(e.target.labels,e=>e.classList.toggle("selected",n)),t.classList.toggle("hidden",!n),this.style.left=n?t.offsetWidth+t.offsetLeft+"px":""},right:function(e){let t=document.getElementById(e.target.value),n=e.target.checked;Array.prototype.forEach.call(e.target.labels,e=>e.classList.toggle("selected",n)),t.classList.toggle("hidden",!n),this.style.right=n?t.parentElement.offsetWidth-t.offsetLeft+"px":""}},t={left:function(e){if(!e.target.checked)return;let t=document.getElementById(e.target.value);this.style.left=t.offsetWidth+t.offsetLeft+"px"},right:function(e){if(!e.target.checked)return;let t=document.getElementById(e.target.value);this.style.right=e.target.checked?t.parentElement.offsetWidth-t.offsetLeft+"px":""}};return function(n,l,i){let o=document.getElementById(l);if(null===o)return console.warn("Could not set up "+i+" panel: element with id '"+l+"' does not exist in document"),!1;o.classList.add("page-panel-"+i);var a=o.hasAttribute("page-panel")?o.getAttribute("page-panel"):"fixed";"fixed"!==a&&(console.warn("Invalid page-panel attribute '"+a+"', using default value 'fixed'"),a="fixed");let d=document.createElement("input");if(d.type="checkbox",d.value=l,d.name=i,d.id="pagectrl_"+i,d.checked=!o.classList.contains("hidden"),document.forms.pagecontrol.appendChild(d),d.addEventListener("change",e[i].bind(n)),d.addEventListener("resize",t[i].bind(n)),o.hasAttribute("hide-toggle")&&function(e,t,n){let l=t.getAttribute("hide-toggle");if(l){var i=document.getElementById(l);if(null!==i){if("LABEL"==i.tagName){if(null===i.control)return i.htmlFor=n.id,void i.classList.toggle("selected",n.checked);i=i.control}"INPUT"===i.tagName&&"checkbox"===i.type?i.addEventListener("change",function(e){var t=new Event("change",{bubbles:!1,cancelable:!1,composed:!1});this.dispatchEvent(t)}.bind(n)):console.warn(`Could not set up hide toggle button for ${n.name} panel: element must be of type input[type='checkbox']`)}else console.warn(`Could not set up hide toggle button for ${n.name} panel: element with id '${l}' does not exist in document`)}}(0,o,d),!1===d.checked)return!0;switch(i){case"left":n.style.left=o.offsetWidth+o.offsetLeft+"px";break;case"right":n.style.right=o.parentElement.offsetWidth-o.offsetLeft+"px"}return!0}}();document.addEventListener("readystatechange",(t=!1,function(l){if(t)return;if(!document.body.hasAttribute("page-main"))return;let i=document.body.getAttribute("page-main"),o=document.getElementById(i);if(null===o)return void("complete"==l.target.readyState&&(console.warn("Could not set up page: element with id '"+i+"' does not exist in document"),document.body.removeAttribute("page-main")));o.classList.add("page-main");let a=document.createElement("form");a.id="pagecontrol",a.style.display="none",document.body.insertBefore(a,document.body.firstChild),document.body.hasAttribute("page-panel-left")&&(n(o,document.body.getAttribute("page-panel-left"),"left")||document.body.removeAttribute("page-panel-left")),document.body.hasAttribute("page-panel-right")&&(n(o,document.body.getAttribute("page-panel-right"),"right")||document.body.removeAttribute("page-panel-right")),document.body.hasAttribute("page-topbar")&&function(e,t,n){let l=document.getElementById(n);if(null===l)return void console.warn("Could not set up topbar: element with id '"+n+"' does not exist in document");l.classList.add("page-topbar"),e.style.top=l.offsetHeight+l.offsetTop+"px";let i=l.hasAttribute("yield")?l.getAttribute("yield").split(","):[],o=t.elements.namedItem("left");null!==o?i.includes("left")?(l.style.left=e.style.left,o.addEventListener("change",function(e){let t=document.getElementById(e.target.value);this.style.left=e.target.checked?t.offsetWidth+t.offsetLeft+"px":""}.bind(l)),o.addEventListener("resize",function(e){if(!e.target.checked)return;let t=document.getElementById(e.target.value);this.style.left=t.offsetWidth+t.offsetLeft+"px"}.bind(l))):document.getElementById(o.value).style.top=e.style.top:document.body.hasAttribute("page-panel-left")&&(i.includes("left")?l.style.left=e.style.left:document.getElementById(document.body.getAttribute("page-panel-left")).style.top=e.style.top);let a=t.elements.namedItem("right");null!==a?i.includes("right")?(l.style.right=e.style.right,a.addEventListener("change",function(e){let t=document.getElementById(e.target.value);this.style.right=e.target.checked?t.parentElement.offsetWidth-t.offsetLeft+"px":""}.bind(l)),a.addEventListener("resize",function(e){if(!e.target.checked)return;let t=document.getElementById(e.target.value);this.style.right=e.target.checked?t.parentElement.offsetWidth-t.offsetLeft+"px":""}.bind(l))):document.getElementById(a.value).style.top=e.style.top:document.body.hasAttribute("page-panel-right")&&(i.includes("right")?l.style.right=e.style.right:document.getElementById(document.body.getAttribute("page-panel-right")).style.top=e.style.top)}(o,a,document.body.getAttribute("page-topbar")),o.hasAttribute("page-tabbed")&&e(o),t=!0,document.body.setAttribute("setup-complete","")}))}();